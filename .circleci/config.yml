version: 2.0
jobs:
  build:
    machine:
      image: ubuntu-2204:2023.04.2
      resource_class: large
      docker_layer_caching: true
    environment:
      - GIT_LFS_SKIP_SMUDGE: 1
    steps:
      - checkout
      - run:
          name: install
          command: |
            apt-get update && apt-get install openjdk-11-jdk -y
            curl -s https://get.nextflow.io | bash && chmod +x nextflow
      - run: apt list --installed
      - run:
          name: test
          command: |
            mkdir -p tests && cd tests
            ../nextflow run ../main.nf -profile test,docker
            ../nextflow run ../main_v2.nf -profile test,docker
          no_output_timeout: 30m
      - store_artifacts:
          path: /root/project/tests/result/pipeline_info
      - store_artifacts:
          path: /root/project/tests/.nextflow.log
          destination: nextflow-log
